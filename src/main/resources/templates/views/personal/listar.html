<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="plantilla/template :: head">
</head>
<body>
	<!-- th:href="@{/css/bootstrap.min.css}" -->
	
	<header th:replace="plantilla/template :: header"></header>
	
		<div class="container d-flex justify-content-center mt-3">
		<div class="card mb-3" style="max-width: 900px;">
			<div class="card-header bg-dark text-white">Registro de Ingreso
				a la Planta</div>
			<div class="row g-0 ">
				<div class="col-md-4" id="imagen">
					<img src="/images/anonimo.jpg" class="img-fluid rounded-start">
				</div>
				<div class="col-md-8">
					<div class="card-body">
						<h5 class="card-title">Registrar asistencia del empleado:</h5>
						<p class="card-text mt-3" th:inline="text">
							<b>Legajo:</b> 
						</p>
						<p class="card-text mt-3" th:inline="text">
							<b>Nombre:</b> 
						</p>
						<p class="card-text mt-3" th:inline="text">
							<b>Apellido:</b> 
						</p>
						<p class="card-text mt-3" th:inline="text">
							<b>Sector de trabajo: </b>
						</p>
						<p class="card-text">
							<b>Fecha y hora del ingreso: </b> <small class="text-muted"><span
								id='date-time'></span>.</small>
						</p>
					</div>
				</div>
			</div>
			<form >
				<div
					class="card-footer bg-dark d-grid gap-2 d-md-flex justify-content-between">
					<a type="button" class="btn btn-primary"
						th:href="@{/views/personal}">Volver</a> <input type="submit"
						class="btn btn-primary btn-sm" value="Registrar" />
				</div>
			</form>

		</div>
	</div>
	
	
	
	<div class="container">
		<h2>Listado del Personal:</h2>
				
		<input type="text" id="formulario" class="form-control">
		<table class="table" style="width: 100%">
			<thead>
				<tr>
					<th scope="col" style="width: 15%;text-align:center;">Legajo</th>
					<th scope="col" style="width: 20%;text-align:center;">Nombre</th>
					<th scope="col" style="width: 20%;text-align:center;">Apellido</th>
					<th scope="col" style="width: 20%;text-align:center;">Sector</th>
					<th scope="col" style="width: 25%;text-align:center;" >Registrar Asistencia</th>
				</tr>
			</thead>
			<tbody id="fila">

			</tbody>
		</table>
	</div>
	<div class="mt-5"></div>
	
	<footer th:replace="plantilla/template ::footer"></footer>
	
	<script th:inline="javascript"> 
		
		var personal = /*[[${personal}]]*/ 'default';
		var link = /*[[@{/views/asistencia/empleado/}]]*/'';
		var urlAsis = '';
	
		const formulario = document.querySelector('#formulario');
		const resultado = document.querySelector('#fila');
		
		const filtrar = () => {
			resultado.innerHTML = '';
			
			console.log(formulario.value);
			const texto = formulario.value.toLowerCase();
			for(let p of personal){
				let nombre = p.nombre.toLowerCase();
				let apellido = p.apellido.toLowerCase();
				let legajo = p.nroLegajo;
				

				
				if(nombre.indexOf(texto) !== -1 || apellido.indexOf(texto) !== -1){
					
					/*   //para mostrar foto (es impracticable)
					let imagePath = `/images/${p.nroLegajo}.jpg`;
					
					if(checkFileExist(imagePath) == false){
						imagePath = `/images/anonimo.jpg`;
					}*/
					
					urlAsis = link + p.nroLegajo;
					
					resultado.innerHTML += `
					<tr>
						<th scope="row" style="text-align:center;">${p.nroLegajo}</th>
						<td style="text-align:center;">${p.nombre}</td>
						<td style="text-align:center;">${p.apellido}</td>
						<td style="text-align:center;">${p.sector}</td>
						<td style="text-align:center;">
							<a href=${urlAsis} class="btn btn-success btn-sm" title:"Registrar Nueva Asistencia" >Asistencia</a>
						</td>
					</tr>
					`
					//<td ><img src="${imagePath}" style="width:70px;height:70px"></td>
				}
			}
		}
		
		function checkFileExist(urlToFile) {
		    var xhr = new XMLHttpRequest();
		    xhr.open('HEAD', urlToFile, false);
		    xhr.send();
		     
		    if (xhr.status == "404") {
		        return false;
		    } else {
		        return true;
		    }
		}
		
		
		formulario.addEventListener('keyup', filtrar);
		
		filtrar();
		
	</script>
</body>
</html>