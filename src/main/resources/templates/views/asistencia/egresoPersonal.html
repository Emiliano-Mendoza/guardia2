<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="plantilla/template :: head">
</head>
<body>

	<header th:replace="plantilla/template :: header"></header>


	<div class="container mt-3">
		
		<h5>Buscar Empleado:</h5>
		<div class="row mt-2">
			<div class="col-md-11">
				<input type="text" id="formulario" class="form-control">
			</div>
			<div class="col-md-1 ">
				<button class="btn btn-primary" onclick="filtrar('buscador')">Buscar</button>
			</div>
			
		</div>
		<div class="row mt-3" id="cardEgreso"></div>

		 
	</div>

	<div class="mt-5"></div>

	<footer th:replace="plantilla/template ::footer"></footer>

	<script th:inline="javascript">
		
		var asistencias = /*[[${asistencias}]]*/ 'default';
		
		const formulario = document.querySelector('#formulario');
		const resultado = document.querySelector('#cardEgreso');
		
		const filtrar = (auxBusqueda) => {
			
			if(formulario.value=='' || auxBusqueda=='buscador'){
				resultado.innerHTML = ''
					
					const texto = formulario.value.toLowerCase();
					
					for(let aut of asistencias){
						let nombre = aut.personal.nombre.toLowerCase();
						let apellido = aut.personal.apellido.toLowerCase();
						
						if(nombre.indexOf(texto) !== -1 || apellido.indexOf(texto) !== -1){
														
							let imagenEmpleado= `/images/${aut.personal.nroLegajo}.jpg` ;
							let idFoo= `foo${aut.personal.nroLegajo}`;
						
							//le doy el formato correcto a la fecha
							let d = new Date(aut.entrada);
							dformat = [d.getDate(),
				  				d.getMonth()+1,
				               d.getFullYear()].join('/')+' '+
				              [d.getHours(),
				               d.getMinutes()].join(':');
							
							if(!aut.enTransito){
								
								let urlEgreso= '/views/asistencia/egreso-empleado/' + aut.idAsistencia;
								let urlEgresoTransitorio= '/views/asistencia/egreso-transitorio/' + aut.idAsistencia;
								
								resultado.innerHTML += `
									<div class="col-sm-6 mt-3">
									<div class="card text-dark bg-light mb-3" >
									<div class="card-header bg-dark text-white">Registro de Egreso
									de la Planta</div>
									<div class="row g-0 ">
										<div class="col-md-4">
											<img src=${imagenEmpleado}
												id=${idFoo}
												style="max-width: 100%; height: auto;"
												onerror="this.onerror=null;this.src='/images/anonimo.jpg';">
										</div>
										<div class="card-body col-md-8">
											<h5 class="card-title">Empleado ingresado:</h5>
											<p class="card-text mt-3">Empleado: ${aut.personal.nombre}
												${aut.personal.apellido}</p>
											<p class="card-text">Número de legajo: ${aut.personal.nroLegajo}</p>
											<p class="card-text mt-3">
												Sector de trabajo: ${aut.personal.sector}
											</p>
											<p class="card-text">
												Fecha y hora del ingreso: ${dformat}
											</p>
						
										</div>
									</div>
									
									<div
									class="card-footer bg-dark d-grid gap-2 d-md-flex justify-content-md-end">
									<form 
										action=${urlEgresoTransitorio}
										object=${aut}
										method="post"  
											onsubmit="return confirm('Confirmar egreso transitorio del empleado ${aut.personal.nombre} ${aut.personal.apellido} ?');">
										
											<input type="submit" class="btn btn-secondary btn-sm"
												value="Egreso Transitorio" />
										
									</form>
									<form 
									action=${urlEgreso}
									object=${aut}
									method="post"  
										onsubmit="return confirm('Confirmar egreso del empleado ${aut.personal.nombre} ${aut.personal.apellido} ?');">
									
										<input type="submit" class="btn btn-primary btn-sm"
											value="Registrar Egreso" />
									
									</form>
									
									</div>
									
								</div>
								</div>
								`;
								
								//------------------
								
							}else{
								
								let urlReingresoTransitorio= '/views/asistencia/reingreso-transitorio/' + aut.idAsistencia;								
								
								resultado.innerHTML += `
									<div class="col-sm-6 mt-3">
									<div class="card text-dark bg-light mb-3" >
									<div class="card-header bg-dark text-white">Registro de Egreso
									de la Planta</div>
									<div class="row g-0 ">
										<div class="col-md-4">
											<img src=${imagenEmpleado}
												id=${idFoo}
												style="max-width: 100%; height: auto;"
												onerror="this.onerror=null;this.src='/images/anonimo.jpg';">
										</div>
										<div class="card-body col-md-8">
											<h5 class="card-title">Empleado en tránsito:</h5>
											<p class="card-text mt-3">Empleado: ${aut.personal.nombre}
												${aut.personal.apellido}</p>
											<p class="card-text">Número de legajo: ${aut.personal.nroLegajo}</p>
											<p class="card-text mt-3">
												Sector de trabajo: ${aut.personal.sector}
											</p>
											<p class="card-text">
												Fecha y hora del ingreso: ${dformat}
											</p>
						
										</div>
									</div>
									
									<div
									class="card-footer bg-dark d-grid gap-2 d-md-flex justify-content-md-end">
									<form 
										action=${urlReingresoTransitorio}
										object=${aut}
										method="post"  
											onsubmit="return confirm('Confirmar reingreso del empleado ${aut.personal.nombre} ${aut.personal.apellido} ?');">
										
											<input type="submit" class="btn btn-secondary btn-sm"
												value="Reingreso" />
										
									</form>
									
									</div>
									
								</div>
								</div>
								`;
							}
							
							
						}
					}
			}			
		}
		
		formulario.addEventListener('keyup', filtrar);
		filtrar();
		
	</script>

</body>
</html>